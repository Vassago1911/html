<!DOCTYPE html><html><head><style>
    html.glowy:hover {
        box-shadow: 0 0 48px rgba(255,255,32,.25);
    }
</style></head><body></body>
<script type="text/javascript">
vbx = 4096;layer_count = 5// -> svg_canvas.js</script>
<script src="svg_canvas.js"></script>
<link href="std.css" rel="stylesheet"/><script src="colours.js"></script>
<script type="text/javascript">
    class Node {
        show_svg_visual () {
            if ( [...document.getElementsByClassName(this.name)].length == 0 ) {
                this.svg = draw_classy_square(x,y,64,this.name)
            }
        }

        highlight() {
            var highlight_svg = [...this.svg.children][0]
            highlight_svg.style.display = "block"
        }

        highlight_off() {
            var highlight_svg = [...this.svg.children][0]
            highlight_svg.style.display = "none"
        }

        dist ( x, y ){
            return parseInt( Math.sqrt( (x-this.x)**2 + (y-this.y)**2 ) )
        }

        set_label ( ix ) {
            this.ix = ix;
        }

        constructor ( x, y ) {
            this.x = x;
            this.y = y;
            this.name = `${Date.now()}`.substring(7)
            this.show_svg_visual()
        }
    }

    class Edge {
        show_svg_visual () {
            this.arrow = draw_classy_arrow(this.g1.x,this.g1.y,this.g2.x,this.g2.y,this.name,16)
            var bg_clr = "#132"
            this.button = draw_classy_square( this.cx, this.cy, 52, this.name, bg_clr )
        }

        highlight() {
            var highlight_svg = [...this.button.children][0]
            highlight_svg.style.display = "block"
        }

        highlight_off() {
            var highlight_svg = [...this.button.children][0]
            highlight_svg.style.display = "none"
        }

        dist( x, y ){
            return parseInt( Math.sqrt( (x-this.cx)**2 + (y-this.cy)**2 ) )
        }

        set_label ( ix ) {
            this.ix = ix;
        }

        constructor ( g , h ) {
            this.g1 = g;
            this.g2 = h;
            this.cx = parseInt((this.g1.x + this.g2.x)/2);
            this.cy = parseInt((this.g1.y + this.g2.y)/2);
            this.name = `${Date.now()}`.substring(7)
            this.show_svg_visual()
            this.normal_=false;
            this.flipped=false;
            this.deleted=false;
        }



        flip() {
            if ( this.normal_ ) {
                this.normal_=false;
                this.flipped=true;
            } else if ( this.flipped ) {
                this.flipped=false;
                this.deleted=true;
            } else if ( this.deleted ) {
                this.normal_=true;
                this.flipped=false;
                this.deleted=false;
            } else { console.log("PANIC!!!! this should not happen!!!");}
            if (!(this.normal_)) {
                x = this.g1;
                this.g1 = this.g2;
                this.g2 = x;
            }

            this.delete_svg_visual()
            this.show_svg_visual()
        }
    }

    class NodeNet {
        constructor () {
            this.nodes = []
            this.net = []
            this.neighbours = {}
            this.edge_list = []
            this.edge_buttons = []
        }

        add_node( evt ) {
            tmp = get_svg_xy_from_event(evt)
            x = tmp[0]
            y = tmp[1]
            g = new Node(x,y)
            this.nodes = this.nodes.concat([g])
            g.set_label( this.nodes.length - 1 )
            this.generate_edges()
        }

        add_edge( g , h ) {
            this.edge_list = this.edge_list.concat([new Edge( g , h )]);
            var ix = this.edge_list.length - 1
            this.edge_list[ix].set_label(ix)
            this.edge_buttons = this.edge_buttons.concat([this.edge_list[ix].button]);
        }

        button_close( x, y ) {
            for ( let i = 0; i < this.edge_list.length; i++ ) {
                g = this.edge_list[i]
                x_ = g.cx - x
                y_ = g.cy - y
                var dist = Math.sqrt( x_**2 + y_**2 )
                if ( dist <= 128 ) {
                    return true;
                }
            }
            return false;
        }

        node_close( x, y ) {
            for ( let i = 0; i < this.nodes.length; i++ ) {
                g = this.nodes[i]
                x_ = g.x - x
                y_ = g.y - y
                var dist = Math.sqrt( x_**2 + y_**2 )
                if ( dist <= 64 ) {
                    return true;
                }
            }
            return false;
        }

        node_or_button_close( x, y ) {
            return this.node_close(x,y) || this.button_close(x,y)
        }

        generate_edges() {
            for (let i = 0; i<this.nodes.length;i++) {
                if (!( i in this.neighbours)) {
                    this.neighbours[i] = {}
                }
                for (let j = i+1; j<this.nodes.length;j++){
                    if (!(j in this.neighbours[i])) {
                        this.neighbours[i][j] = 1;
                        this.add_edge( this.nodes[i], this.nodes[j] )
                    }
                }
            }
        }
    }

    gnet = new NodeNet()

    function find_hovered(evt) {
        tmp = get_svg_xy_from_event(evt)
        x = tmp[0]
        y = tmp[1]
        nodes = gnet.nodes;
        edges = gnet.edge_list;
        res = []
        toggles = []
        for ( let n = 0; n < nodes.length; n++ ){
            if ( nodes[n].dist(x,y) <= 70 ) {
                nodes[n].highlight()
                toggles = toggles.concat([nodes[n]])
            } else {
                nodes[n].highlight_off()
            }
        }
        for ( let e = 0; e < edges.length; e++ ){
            if ( edges[e].dist(x,y) <= 132 ) {
                edges[e].highlight()
                toggles = toggles.concat([edges[e]])
            } else {
                edges[e].highlight_off()
            }
        }
        if (evt.type == "click") {
            console.log("I know you're a click!")
            console.log(evt)
            return res;
        }
        return toggles;
    }

    function if_nothing_hovered_add_node(evt){
        tmp = get_svg_xy_from_event(evt)
        x = tmp[0]
        y = tmp[1]
        sth_close = gnet.node_or_button_close(x,y)
        if ( !sth_close ) {
            gnet.add_node(evt);
            console.log(evt)
        } else {
            buttons = find_hovered(evt);
        }
    }

    svg = document.getElementById("total_svg1")
    //svg.addEventListener('mousemove',find_hovered)

    svg.addEventListener("click",if_nothing_hovered_add_node)
</script>
</html>